<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracker de Recursos - Phandalin</title>
    <style>
        :root {
            --color-dark: #3c2c23;
            --color-medium: #8b5a2b;
            --color-light: #d9b38c;
            --color-highlight: #ffcc80;
            --color-prosperity: #4caf50;
            --color-security: #f44336;
            --color-population: #2196f3;
            --color-gold: #ffd700;
            --color-taxes: #9c27b0;
            --color-lifestyle: #ff9800;
            --color-upkeep: #795548;
            --color-profit: #009688;
        }
        
        body {
            font-family: 'Times New Roman', serif;
            background-color: #f5eee6;
            color: var(--color-dark);
            margin: 0;
            padding: 20px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect fill="none" stroke="%238b5a2b33" stroke-width="2" x="10" y="10" width="80" height="80"/></svg>');
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 253, 248, 0.9);
            padding: 20px;
            border: 3px solid var(--color-medium);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            border-radius: 5px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--color-medium);
            padding-bottom: 15px;
        }
        
        h1 {
            color: var(--color-dark);
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 3px rgba(0, 0, 0, 0.1);
        }
        
        .subtitle {
            font-style: italic;
            color: var(--color-medium);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(to bottom right, var(--color-light), #e9d6bd);
            border: 2px solid var(--color-medium);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 3px 3px 7px rgba(0, 0, 0, 0.1);
        }
        
        .stat-title {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
            color: var(--color-dark);
            border-bottom: 1px solid var(--color-medium);
            padding-bottom: 5px;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-input {
            width: 80px;
            text-align: center;
            font-size: 1.2em;
            padding: 5px;
            border: 1px solid var(--color-medium);
            border-radius: 4px;
        }
        
        .stat-slider {
            width: 80%;
            margin: 10px 0;
        }
        
        .prosperity { color: var(--color-prosperity); }
        .security { color: var(--color-security); }
        .population { color: var(--color-population); }
        .gold { color: var(--color-gold); }
        .taxes { color: var(--color-taxes); }
        .lifestyle { color: var(--color-lifestyle); }
        .upkeep { color: var(--color-upkeep); }
        .profit { color: var(--color-profit); }
        
        .classes-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: white;
            font-size: 0.9em;
        }
        
        .classes-table th, .classes-table td {
            border: 1px solid var(--color-medium);
            padding: 8px;
            text-align: center;
        }
        
        .classes-table th {
            background-color: var(--color-medium);
            color: white;
            position: sticky;
            top: 0;
        }
        
        .classes-table tr:nth-child(even) {
            background-color: var(--color-light);
        }
        
        .table-container {
            overflow-x: auto;
            margin-bottom: 20px;
        }
        
        .tax-info {
            background-color: #f3e5f5;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid var(--color-taxes);
            margin: 20px 0;
        }
        
        .notes-section {
            margin-top: 30px;
        }
        
        textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid var(--color-medium);
            border-radius: 4px;
            background-color: #fffdf8;
            font-family: inherit;
        }
        
        .comparison {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            font-size: 0.9em;
            color: var(--color-medium);
        }
        
        .button {
            background-color: var(--color-medium);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            font-size: 1em;
            margin-top: 10px;
        }
        
        .button:hover {
            background-color: var(--color-dark);
        }
        
        .reset-button {
            background-color: #f44336;
        }
        
        .info-text {
            font-style: italic;
            color: var(--color-medium);
            margin-top: 5px;
            font-size: 0.9em;
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .classes-table {
                font-size: 0.8em;
            }
            
            .classes-table th, .classes-table td {
                padding: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Tracker de Recursos - Phandalin</h1>
            <p class="subtitle">Módulo: Phandalin and Below</p>
        </header>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-title">População</div>
                <div class="stat-value population" id="population-value">80</div>
                <input type="number" class="stat-input" id="population-input" min="0" max="125000" value="80">
                <input type="range" class="stat-slider" id="population-slider" min="0" max="125000" value="80" step="10">
                <div>0 (Vila Arruinada) — 125.000 (Cidade Próspera)</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-title">Prosperidade</div>
                <div class="stat-value prosperity" id="prosperity-value">25</div>
                <input type="range" class="stat-slider" id="prosperity-slider" min="0" max="100" value="25">
                <div>0 (Colapso Total) — 100 (Máxima Prosperidade)</div>
                <div class="info-text" id="prosperity-bonus">Bônus de Renda: +12.5%</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-title">Segurança</div>
                <div class="stat-value security" id="security-value">30</div>
                <input type="range" class="stat-slider" id="security-slider" min="0" max="100" value="30">
                <div>0 (Anarquia) — 100 (Totalmente Segura)</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-title">Tesouro (GP)</div>
                <div class="stat-value gold" id="gold-value">500</div>
                <input type="number" class="stat-input" id="gold-input" min="0" value="500">
            </div>
        </div>
        
        <div class="tax-info">
            <h2>Sistema de Impostos</h2>
            <div class="stat-title">Taxa de Impostos</div>
            <div class="stat-value taxes" id="tax-rate-value">10%</div>
            <input type="range" class="stat-slider" id="tax-rate-slider" min="5" max="30" value="10">
            <div>5% (Baixo) — 30% (Alto)</div>
            
            <div class="stat-title">Arrecadação Mensal de Impostos</div>
            <div class="stat-value taxes" id="tax-revenue-value">15.6 GP</div>
            <button class="button" id="collect-taxes">Coletar Impostos</button>
            <button class="button reset-button" id="reset-data">Resetar Dados</button>
        </div>
        
        <h2>Distribuição de Classes Sociais</h2>
        <div class="table-container">
            <table class="classes-table">
                <thead>
                    <tr>
                        <th>Classe Social</th>
                        <th>% da População</th>
                        <th>Quantidade</th>
                        <th>Renda Mínima/Mês</th>
                        <th>Lifestyle/Mês</th>
                        <th>Upkeep/Mês</th>
                        <th>Taxes/Mês</th>
                        <th>Profit/Mês</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Pobre</td>
                        <td><input type="number" class="percent-input" id="poor-percent" min="0" max="100" value="60">%</td>
                        <td id="poor-count">48</td>
                        <td id="poor-income">6 gp</td>
                        <td id="poor-lifestyle">3 gp</td>
                        <td id="poor-upkeep">2 gp</td>
                        <td id="poor-tax">0.6 gp</td>
                        <td id="poor-profit">0.4 gp</td>
                    </tr>
                    <tr>
                        <td>Modesta</td>
                        <td><input type="number" class="percent-input" id="modest-percent" min="0" max="100" value="30">%</td>
                        <td id="modest-count">24</td>
                        <td id="modest-income">30 gp</td>
                        <td id="modest-lifestyle">15 gp</td>
                        <td id="modest-upkeep">10 gp</td>
                        <td id="modest-tax">3 gp</td>
                        <td id="modest-profit">2 gp</td>
                    </tr>
                    <tr>
                        <td>Confortável</td>
                        <td><input type="number" class="percent-input" id="comfortable-percent" min="0" max="100" value="8">%</td>
                        <td id="comfortable-count">6</td>
                        <td id="comfortable-income">60 gp</td>
                        <td id="comfortable-lifestyle">30 gp</td>
                        <td id="comfortable-upkeep">20 gp</td>
                        <td id="comfortable-tax">6 gp</td>
                        <td id="comfortable-profit">4 gp</td>
                    </tr>
                    <tr>
                        <td>Rica</td>
                        <td><input type="number" class="percent-input" id="wealthy-percent" min="0" max="100" value="2">%</td>
                        <td id="wealthy-count">2</td>
                        <td id="wealthy-income">120 gp</td>
                        <td id="wealthy-lifestyle">60 gp</td>
                        <td id="wealthy-upkeep">40 gp</td>
                        <td id="wealthy-tax">12 gp</td>
                        <td id="wealthy-profit">8 gp</td>
                    </tr>
                    <tr>
                        <td>Aristocrática</td>
                        <td><input type="number" class="percent-input" id="aristocratic-percent" min="0" max="100" value="0">%</td>
                        <td id="aristocratic-count">0</td>
                        <td id="aristocratic-income">300 gp</td>
                        <td id="aristocratic-lifestyle">150 gp</td>
                        <td id="aristocratic-upkeep">100 gp</td>
                        <td id="aristocratic-tax">30 gp</td>
                        <td id="aristocratic-profit">20 gp</td>
                    </tr>
                    <tr>
                        <td colspan="3"><strong>Total</strong></td>
                        <td id="total-income">-</td>
                        <td id="total-lifestyle">-</td>
                        <td id="total-upkeep">-</td>
                        <td id="total-tax">15.6 gp</td>
                        <td id="total-profit">-</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="comparison">
            <div>Phandalin Atual: 80 habitantes</div>
            <div>Cidade Próspera: 125.000 habitantes</div>
        </div>
        
        <div class="notes-section">
            <h2>Anotações e Eventos</h2>
            <textarea id="notes" placeholder="Registre aqui eventos importantes, mudanças na vila, ameaças, etc."></textarea>
        </div>
    </div>

    <script>
        // Elementos do DOM
        const populationInput = document.getElementById('population-input');
        const populationSlider = document.getElementById('population-slider');
        const populationValue = document.getElementById('population-value');
        const prosperitySlider = document.getElementById('prosperity-slider');
        const prosperityValue = document.getElementById('prosperity-value');
        const prosperityBonus = document.getElementById('prosperity-bonus');
        const securitySlider = document.getElementById('security-slider');
        const securityValue = document.getElementById('security-value');
        const goldInput = document.getElementById('gold-input');
        const goldValue = document.getElementById('gold-value');
        const taxRateSlider = document.getElementById('tax-rate-slider');
        const taxRateValue = document.getElementById('tax-rate-value');
        const taxRevenueValue = document.getElementById('tax-revenue-value');
        const collectTaxesButton = document.getElementById('collect-taxes');
        const resetButton = document.getElementById('reset-data');
        
        const percentInputs = [
            document.getElementById('poor-percent'),
            document.getElementById('modest-percent'),
            document.getElementById('comfortable-percent'),
            document.getElementById('wealthy-percent'),
            document.getElementById('aristocratic-percent')
        ];
        
        const countElements = [
            document.getElementById('poor-count'),
            document.getElementById('modest-count'),
            document.getElementById('comfortable-count'),
            document.getElementById('wealthy-count'),
            document.getElementById('aristocratic-count')
        ];
        
        // Valores base (sem bônus de prosperidade)
        const baseIncomes = [6, 30, 60, 120, 300];
        const baseLifestyles = [3, 15, 30, 60, 150];
        const baseUpkeeps = [2, 10, 20, 40, 100];
        const baseProfits = [0.4, 2, 4, 8, 20];
        
        // Elementos para income, lifestyle, upkeep, profit e tax
        const incomeElements = [
            document.getElementById('poor-income'),
            document.getElementById('modest-income'),
            document.getElementById('comfortable-income'),
            document.getElementById('wealthy-income'),
            document.getElementById('aristocratic-income')
        ];
        
        const lifestyleElements = [
            document.getElementById('poor-lifestyle'),
            document.getElementById('modest-lifestyle'),
            document.getElementById('comfortable-lifestyle'),
            document.getElementById('wealthy-lifestyle'),
            document.getElementById('aristocratic-lifestyle')
        ];
        
        const upkeepElements = [
            document.getElementById('poor-upkeep'),
            document.getElementById('modest-upkeep'),
            document.getElementById('comfortable-upkeep'),
            document.getElementById('wealthy-upkeep'),
            document.getElementById('aristocratic-upkeep')
        ];
        
        const profitElements = [
            document.getElementById('poor-profit'),
            document.getElementById('modest-profit'),
            document.getElementById('comfortable-profit'),
            document.getElementById('wealthy-profit'),
            document.getElementById('aristocratic-profit')
        ];
        
        const taxElements = [
            document.getElementById('poor-tax'),
            document.getElementById('modest-tax'),
            document.getElementById('comfortable-tax'),
            document.getElementById('wealthy-tax'),
            document.getElementById('aristocratic-tax')
        ];
        
        // Elementos totais
        const totalIncomeElement = document.getElementById('total-income');
        const totalLifestyleElement = document.getElementById('total-lifestyle');
        const totalUpkeepElement = document.getElementById('total-upkeep');
        const totalTaxElement = document.getElementById('total-tax');
        const totalProfitElement = document.getElementById('total-profit');
        
        // Sincronizar inputs de população
        populationInput.addEventListener('input', function() {
            populationSlider.value = this.value;
            populationValue.textContent = this.value;
            updatePopulationCounts();
            calculateEconomy();
            saveData();
        });
        
        populationSlider.addEventListener('input', function() {
            populationInput.value = this.value;
            populationValue.textContent = this.value;
            updatePopulationCounts();
            calculateEconomy();
            saveData();
        });
        
        // Atualizar sliders de prosperidade e segurança
        prosperitySlider.addEventListener('input', function() {
            prosperityValue.textContent = this.value;
            updateProsperityBonus();
            calculateEconomy();
            saveData();
        });
        
        securitySlider.addEventListener('input', function() {
            securityValue.textContent = this.value;
            saveData();
        });
        
        // Sincronizar input de ouro
        goldInput.addEventListener('input', function() {
            goldValue.textContent = this.value;
            saveData();
        });
        
        // Atualizar taxa de impostos
        taxRateSlider.addEventListener('input', function() {
            const taxRate = parseInt(this.value);
            taxRateValue.textContent = `${taxRate}%`;
            calculateEconomy();
            saveData();
        });
        
        // Coletar impostos
        collectTaxesButton.addEventListener('click', function() {
            const currentGold = parseInt(goldInput.value) || 0;
            const taxRevenue = parseFloat(taxRevenueValue.textContent) || 0;
            goldInput.value = currentGold + taxRevenue;
            goldValue.textContent = goldInput.value;
            
            // Registrar no log de eventos
            const notes = document.getElementById('notes');
            const date = new Date().toLocaleDateString();
            notes.value = `[${date}] Impostos coletados: ${taxRevenue.toFixed(1)} GP\n` + notes.value;
            
            saveData();
        });
        
        // Resetar dados
        resetButton.addEventListener('click', function() {
            if (confirm('Tem certeza que deseja resetar todos os dados? Isso não pode ser desfeito.')) {
                localStorage.removeItem('phandalinData');
                
                // Resetar valores para os padrões
                populationInput.value = 80;
                populationSlider.value = 80;
                populationValue.textContent = 80;
                
                prosperitySlider.value = 25;
                prosperityValue.textContent = 25;
                
                securitySlider.value = 30;
                securityValue.textContent = 30;
                
                goldInput.value = 500;
                goldValue.textContent = 500;
                
                taxRateSlider.value = 10;
                taxRateValue.textContent = '10%';
                
                percentInputs[0].value = 60;
                percentInputs[1].value = 30;
                percentInputs[2].value = 8;
                percentInputs[3].value = 2;
                percentInputs[4].value = 0;
                
                document.getElementById('notes').value = '';
                
                updatePopulationCounts();
                updateProsperityBonus();
                calculateEconomy();
            }
        });
        
        // Atualizar contagens de população por classe
        function updatePopulationCounts() {
            const totalPopulation = parseInt(populationInput.value) || 0;
            let totalPercent = 0;
            
            // Calcular percentual total
            for (const input of percentInputs) {
                totalPercent += parseInt(input.value || 0);
            }
            
            // Ajustar se total não for 100%
            if (totalPercent !== 100) {
                console.log("Atenção: a soma dos percentuais não é 100%");
            }
            
            // Atualizar contagens
            for (let i = 0; i < percentInputs.length; i++) {
                const percent = parseInt(percentInputs[i].value || 0);
                const count = Math.round(totalPopulation * percent / 100);
                countElements[i].textContent = count;
            }
        }
        
        // Atualizar bônus de prosperidade
        function updateProsperityBonus() {
            const prosperity = parseInt(prosperitySlider.value);
            const prosperityMultiplier = Math.floor(prosperity / 5) * 0.025;
            prosperityBonus.textContent = `Bônus de Renda: +${(prosperityMultiplier * 100).toFixed(1)}%`;
        }
        
        // Calcular economia com base na prosperidade e taxa de impostos
        function calculateEconomy() {
            const taxRate = parseInt(taxRateSlider.value) || 10;
            const prosperity = parseInt(prosperitySlider.value);
            const prosperityMultiplier = 1 + (Math.floor(prosperity / 5) * 0.025);
            
            let totalIncome = 0;
            let totalLifestyle = 0;
            let totalUpkeep = 0;
            let totalTaxRevenue = 0;
            let totalProfit = 0;
            
            for (let i = 0; i < percentInputs.length; i++) {
                const count = parseInt(countElements[i].textContent) || 0;
                
                // Calcular valores ajustados pela prosperidade
                const income = baseIncomes[i] * prosperityMultiplier;
                const lifestyle = baseLifestyles[i] * prosperityMultiplier;
                const upkeep = baseUpkeeps[i] * prosperityMultiplier;
                const baseProfit = baseProfits[i] * prosperityMultiplier;
                
                // Calcular impostos (10% da renda é a base, ajustado pela taxa atual)
                const tax = income * (taxRate / 100);
                const profit = income - lifestyle - upkeep - tax;
                
                // Atualizar displays
                incomeElements[i].textContent = `${income.toFixed(1)} gp`;
                lifestyleElements[i].textContent = `${lifestyle.toFixed(1)} gp`;
                upkeepElements[i].textContent = `${upkeep.toFixed(1)} gp`;
                taxElements[i].textContent = `${tax.toFixed(1)} gp`;
                profitElements[i].textContent = `${profit.toFixed(1)} gp`;
                
                // Calcular totais
                totalIncome += income * count;
                totalLifestyle += lifestyle * count;
                totalUpkeep += upkeep * count;
                totalTaxRevenue += tax * count;
                totalProfit += profit * count;
            }
            
            // Atualizar totais
            totalIncomeElement.textContent = `${totalIncome.toFixed(1)} gp`;
            totalLifestyleElement.textContent = `${totalLifestyle.toFixed(1)} gp`;
            totalUpkeepElement.textContent = `${totalUpkeep.toFixed(1)} gp`;
            totalTaxElement.textContent = `${totalTaxRevenue.toFixed(1)} gp`;
            totalProfitElement.textContent = `${totalProfit.toFixed(1)} gp`;
            
            // Atualizar arrecadação de impostos
            taxRevenueValue.textContent = totalTaxRevenue.toFixed(1);
        }
        
        // Adicionar listeners para os inputs de percentual
        for (const input of percentInputs) {
            input.addEventListener('input', function() {
                updatePopulationCounts();
                calculateEconomy();
                saveData();
            });
        }
        
        // Salvar dados no localStorage
        function saveData() {
            const data = {
                population: populationInput.value,
                prosperity: prosperitySlider.value,
                security: securitySlider.value,
                gold: goldInput.value,
                taxRate: taxRateSlider.value,
                poorPercent: document.getElementById('poor-percent').value,
                modestPercent: document.getElementById('modest-percent').value,
                comfortablePercent: document.getElementById('comfortable-percent').value,
                wealthyPercent: document.getElementById('wealthy-percent').value,
                aristocraticPercent: document.getElementById('aristocratic-percent').value,
                notes: document.getElementById('notes').value
            };
            localStorage.setItem('phandalinData', JSON.stringify(data));
        }
        
        // Carregar dados do localStorage
        function loadData() {
            const savedData = localStorage.getItem('phandalinData');
            if (savedData) {
                const data = JSON.parse(savedData);
                
                // Restaurar valores dos controles
                populationInput.value = data.population;
                populationSlider.value = data.population;
                populationValue.textContent = data.population;
                
                prosperitySlider.value = data.prosperity;
                prosperityValue.textContent = data.prosperity;
                
                securitySlider.value = data.security;
                securityValue.textContent = data.security;
                
                goldInput.value = data.gold;
                goldValue.textContent = data.gold;
                
                taxRateSlider.value = data.taxRate;
                taxRateValue.textContent = `${data.taxRate}%`;
                
                document.getElementById('poor-percent').value = data.poorPercent;
                document.getElementById('modest-percent').value = data.modestPercent;
                document.getElementById('comfortable-percent').value = data.comfortablePercent;
                document.getElementById('wealthy-percent').value = data.wealthyPercent;
                document.getElementById('aristocratic-percent').value = data.aristocraticPercent;
                
                document.getElementById('notes').value = data.notes;
                
                // Atualizar displays
                updatePopulationCounts();
                updateProsperityBonus();
                calculateEconomy();
            }
        }
        
        // Inicializar
        window.addEventListener('load', function() {
            loadData();
        });
        
        updatePopulationCounts();
        updateProsperityBonus();
        calculateEconomy();
    </script>
</body>
</html>
